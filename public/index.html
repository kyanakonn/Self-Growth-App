<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Self Growth App</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body{margin:0;font-family:sans-serif;background:#f4f6f8}
.screen{display:none;padding:16px}
.screen.active{display:block}
button{padding:8px 12px;margin:4px}
.card{background:#fff;padding:12px;border-radius:10px;margin-bottom:12px}
.hidden{display:none}
.exp-bar{background:#ddd;height:10px;border-radius:5px;overflow:hidden}
.exp-fill{background:#4caf50;height:100%;width:0%}
.timer-full{text-align:center}
#timerText{font-size:48px;margin:20px 0}
.subject-item{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.subject-item button{background:#ff5c5c;color:white;border:none;border-radius:6px}
</style>
</head>

<body>

<!-- ===== ã‚¹ã‚¿ãƒ¼ãƒˆ ===== -->
<div id="start" class="screen active">
<h1>ğŸ“š Self Growth App</h1>
<button onclick="newStart()">æ–°è¦ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
</div>

<!-- ===== ãƒ›ãƒ¼ãƒ  ===== -->
<div id="home" class="screen">
<button onclick="goProfile()">ğŸ‘¤ ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«</button>

<div class="card">
Lv <span id="level"></span>
<div class="exp-bar"><div id="expFill" class="exp-fill"></div></div>
</div>

<div class="card">
<h3>âœï¸ æ‰‹å‹•è¨˜éŒ²</h3>
<select id="manualSubject"></select>
<input id="h" type="number" placeholder="æ™‚é–“">
<input id="m" type="number" placeholder="åˆ†">
<button onclick="manualSave()">ä¿å­˜</button>
</div>

<div class="card">
<h3>â• ç§‘ç›®è¿½åŠ </h3>
<input id="newSub">
<button onclick="addSubject()">è¿½åŠ </button>
</div>

<div class="card">
<h3>ğŸ—‘ ç§‘ç›®ç®¡ç†</h3>
<div id="subjectManage"></div>
</div>

<button onclick="openTimer()">â± ã‚¿ã‚¤ãƒãƒ¼</button>

<div class="card">
<h3>ğŸ“Š å‹‰å¼·ã‚°ãƒ©ãƒ•</h3>
<canvas id="chartEl"></canvas>
</div>

<button onclick="openAI()">ğŸ¤– æ¨¡æ“¬AIåˆ¤å®š</button>
</div>

<!-- ===== ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« ===== -->
<div id="profile" class="screen">
<button onclick="goHome()">â† æˆ»ã‚‹</button>
<div class="card">
<p>ãƒ¬ãƒ™ãƒ«: <span id="pLevel"></span></p>
<p>åˆè¨ˆæ™‚é–“: <span id="pTime"></span> æ™‚é–“</p>
<p>é€£ç¶šæ—¥æ•°: <span id="pStreak"></span></p>
</div>
</div>

<!-- ===== ã‚¿ã‚¤ãƒãƒ¼ ===== -->
<div id="timerFull" class="screen timer-full">
<select id="timerSubject"></select>
<div id="timerText">0:00</div>
<button onclick="startTimer()">START</button>
<button onclick="stopTimer()">STOP</button>
<button onclick="saveTimer()">ä¿å­˜</button>
</div>

<!-- ===== AI ===== -->
<div id="ai" class="screen">
<button onclick="goHome()">â† æˆ»ã‚‹</button>
<div class="card">
<h2>ğŸ¤– AIå­¦ç¿’è©•ä¾¡</h2>
<p id="aiOverall"></p>
</div>
</div>

<script>
/* ===== åŸºæœ¬ãƒ‡ãƒ¼ã‚¿ ===== */
const DEFAULT_SUBJECTS = ["è‹±èª","å›½èª","ä¸–ç•Œå²","æ•°å­¦","ç†ç§‘"]

let data = JSON.parse(localStorage.getItem("sgData")) || {
  subjects:[...DEFAULT_SUBJECTS],
  logs:{},
  exp:0,
  level:1,
  streak:0,
  lastDate:null
}

let timerSec = 0
let timerInt = null

/* ===== ç”»é¢ ===== */
function show(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"))
  document.getElementById(id).classList.add("active")
}
function goHome(){show("home");render()}
function goProfile(){
  show("profile")
  pLevel.textContent=data.level
  pTime.textContent=(totalMinutes()/60).toFixed(1)
  pStreak.textContent=data.streak
}
function openTimer(){show("timerFull");renderSubjects()}
function openAI(){
  show("ai")
  aiOverall.textContent=`ç¾åœ¨ã®ç¶™ç¶šåŠ›ã¯è‰¯å¥½ã§ã™ï¼ˆé€£ç¶š${data.streak}æ—¥ï¼‰`
}

/* ===== åˆæœŸåŒ– ===== */
function newStart(){
  data.subjects=[...DEFAULT_SUBJECTS]
  data.logs={}
  data.exp=0
  data.level=1
  data.streak=0
  data.lastDate=null
  save()
  show("home")
  render()
}

/* ===== ç§‘ç›®å‡¦ç† ===== */
function renderSubjects(){
  manualSubject.innerHTML=""
  timerSubject.innerHTML=""
  subjectManage.innerHTML=""

  data.subjects.forEach(s=>{
    manualSubject.add(new Option(s,s))
    timerSubject.add(new Option(s,s))

    const div=document.createElement("div")
    div.className="subject-item"
    div.textContent=s

    if(!DEFAULT_SUBJECTS.includes(s)){
      const btn=document.createElement("button")
      btn.textContent="å‰Šé™¤"
      btn.onclick=()=>removeSubject(s)
      div.appendChild(btn)
    }
    subjectManage.appendChild(div)
  })
}

function addSubject(){
  const v=newSub.value.trim()
  if(!v||data.subjects.includes(v))return
  data.subjects.push(v)
  save()
  newSub.value=""
  render()
}

function removeSubject(s){
  if(DEFAULT_SUBJECTS.includes(s))return
  data.subjects=data.subjects.filter(x=>x!==s)
  delete data.logs[s]
  save()
  render()
}

/* ===== è¨˜éŒ² ===== */
function manualSave(){
  const s=manualSubject.value
  const min=(+h.value||0)*60+(+m.value||0)
  if(min<=0)return
  addLog(s,min)
  h.value=m.value=""
  render()
}

function startTimer(){
  if(timerInt)return
  timerInt=setInterval(()=>{
    timerSec++
    timerText.textContent=`${Math.floor(timerSec/60)}:${(timerSec%60).toString().padStart(2,"0")}`
  },1000)
}
function stopTimer(){
  clearInterval(timerInt)
  timerInt=null
}
function saveTimer(){
  stopTimer()
  if(timerSec>=60){
    addLog(timerSubject.value,Math.floor(timerSec/60))
  }
  timerSec=0
  timerText.textContent="0:00"
  goHome()
}

/* ===== ãƒ­ã‚°ãƒ»çµŒé¨“å€¤ ===== */
function addLog(s,min){
  data.logs[s]=(data.logs[s]||0)+min
  data.exp+=min
  updateStreak()
  while(data.exp>=data.level*100){
    data.exp-=data.level*100
    data.level++
  }
  save()
}

function updateStreak(){
  const today=new Date().toDateString()
  if(data.lastDate!==today){
    data.streak++
    data.lastDate=today
  }
}

function totalMinutes(){
  return Object.values(data.logs).reduce((a,b)=>a+b,0)
}

/* ===== ã‚°ãƒ©ãƒ• ===== */
let chart
function renderChart(){
  const ctx=chartEl.getContext("2d")
  const labels=data.subjects
  const vals=labels.map(s=>data.logs[s]||0)
  if(chart)chart.destroy()
  chart=new Chart(ctx,{
    type:"bar",
    data:{labels,datasets:[{data:vals}]}
  })
}

/* ===== æç”» ===== */
function render(){
  level.textContent=data.level
  expFill.style.width=`${(data.exp/(data.level*100))*100}%`
  renderSubjects()
  renderChart()
}

function save(){
  localStorage.setItem("sgData",JSON.stringify(data))
}

/* åˆæœŸè¡¨ç¤º */
render()
</script>
</body>
</html>
